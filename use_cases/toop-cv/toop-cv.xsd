<?xml version="1.0" encoding="UTF-8" ?>
<xsd:schema xmlns="urn:eu:toop:ns:dataexchange-1p40" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:dcat-ap="http://data.europa.eu/r5r/" xmlns:cbc="https://semic.org/sa/cv/common/cbc-2.0.0#"
  xmlns:cagv="https://semic.org/sa/cv/cagv/agent-2.0.0#"
  xmlns:cccev="https://semic.org/sa/cv/cccev-2.0.0#"
  targetNamespace="urn:eu:toop:ns:dataexchange-1p40" version="specsVersion1.4.0"
  elementFormDefault="qualified" attributeFormDefault="unqualified">

  <xsd:import namespace="http://data.europa.eu/r5r/"
    schemaLocation="../../../CCCEV/dcat-ap/2.0.0/xml/dcat-ap.xsd"/>
  <xsd:import namespace="https://semic.org/sa/cv/cagv/agent-2.0.0#"
    schemaLocation="../../../CCCEV/cagv/2.0.0/xml/CV-Agent.xsd"/>
  <xsd:import namespace="https://semic.org/sa/cv/cccev-2.0.0#"
    schemaLocation="../../../CCCEV/cccev/2.0.0/xml/cccev-2.0.0.xsd"/>
  <xsd:import namespace="https://semic.org/sa/cv/common/cbc-2.0.0#"
    schemaLocation="../../../CCCEV/common/2.0.0/xml/CV-CommonBasicComponents.xsd"/>

  <!--alternative ROOT elements-->
  <xsd:element name="Request" type="TOOPRequestType"/>
  <xsd:element name="Response" type="TOOPResponseType"/>
  <!--element declaration-->
  <xsd:element name="CopyIndicator" type="cbc:IndicatorType"/>
  <xsd:element name="DataConsumer" type="DataConsumerType"/>
  <xsd:element name="DataConsumerDocumentIdentifier" type="cbc:IDType"/>
  <xsd:element name="DataConsumerGlobalSessionIdentifier" type="cbc:IDType"/>
  <xsd:element name="DataConsumerRequestPurpose" type="cbc:TextType"/>
  <xsd:element name="DataProvider" type="DataProviderType"/>
  <xsd:element name="DataRequestAuthorisation" type="DataRequestAuthorisationType"/>
  <xsd:element name="DataRequestIdentifier" type="cbc:IDType"/>
  <xsd:element name="DataRequestSubject" type="DataRequestSubjectType"/>
  <xsd:element name="EvidenceRequest" type="EvidenceRequestType"/>
  <xsd:element name="Error" type="ErrorType"/>
  <xsd:element name="EvidenceResponse" type="EvidenceResponseType"/>
  <xsd:element name="RoutingInformation" type="RoutingInformationType"/>
  <xsd:element name="SpecificationIdentifier" type="cbc:IDType"/>

  <!--************************** -->
  <!--COMMON elements start here -->

  <!-- Abstract base class containing elements common to both the TOOP EDM Request and the EDM Response -->
  <xsd:complexType name="EDMType">
    <xsd:complexContent>
      <xsd:extension base="dcat-ap:DatasetType">
        <xsd:sequence>
          <xsd:element ref="RoutingInformation" minOccurs="0" maxOccurs="1"/>
          <xsd:element ref="DataRequestAuthorisation" minOccurs="0" maxOccurs="1"/>
        </xsd:sequence>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="RoutingInformationType">
    <xsd:sequence>
      <xsd:element name="DocumentTypeIdentifier" type="cbc:IDType"/>
      <xsd:element name="ProcessIdentifier" type="cbc:IDType"/>
      <xsd:element name="DataConsumerElectronicAddressIdentifier" type="cbc:IDType"/>
      <xsd:element name="DataConsumerCountryCode" type="cbc:CodeType"/>
      <xsd:element name="DataProviderElectronicAddressIdentifier" type="cbc:IDType" minOccurs="0"
        maxOccurs="1"/>
      <xsd:element name="DataProviderCountryCode" type="cbc:CodeType"/>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="PreferredDocumentMimeTypeCodeType">
    <xsd:simpleContent>
      <xsd:extension base="cbc:CodeType">
        <xsd:attribute name="priority" type="xsd:decimal" use="optional"/>
      </xsd:extension>
    </xsd:simpleContent>
  </xsd:complexType>

  <xsd:complexType name="DataConsumerType">
    <xsd:sequence>
      <xsd:element name="DCUniqueIdentifier" type="cbc:IDType"/>
      <xsd:element ref="cbc:Name"/>
      <xsd:element name="DCLegalAddress" type="cagv:AddressType" minOccurs="0" maxOccurs="1"/>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="DataRequestAuthorisationType">
    <xsd:sequence>
      <xsd:element name="ConsentToken" type="cbc:BinaryObjectType"/>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="DataProviderType">
    <xsd:sequence>
      <xsd:element name="AdministrativeUnit" type="cbc:TextType" minOccurs="0" maxOccurs="unbounded"/>
      <xsd:element name="DPContactDetails" type="cagv:ContactPointType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="DCName" type="cbc:NameType"/>
      <xsd:element name="DCLegalAddress" type="cagv:AddressType" minOccurs="0" maxOccurs="1"/>
      <xsd:element ref="cbc:ID"/>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="DataRequestSubjectType">
    <xsd:sequence>
      <xsd:element name="Type" type="cbc:CodeType"/>
      <xsd:element name="LegalPerson" type="LegalPersonType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="NaturalPerson" type="NaturalPersonType" minOccurs="0" maxOccurs="1"/>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="EvidenceRequestType">
    <xsd:complexContent>
      <xsd:extension base="dcat-ap:DatasetType">
        <xsd:sequence>
          <xsd:element name="RequirementForEvidence" type="cccev:CriterionType"/>
        </xsd:sequence>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="ErrorType">
    <xsd:complexContent>
      <xsd:extension base="dcat-ap:DatasetType">
        <xsd:sequence>
          <xsd:sequence>
            <xsd:element name="Category" type="cbc:CodeType"/>
            <xsd:element ref="cbc:Code"/>
            <xsd:element name="Origin" type="cbc:CodeType"/>
            <xsd:element name="dataProviderID" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
            <xsd:element name="Severity" type="cbc:CodeType"/>
          </xsd:sequence>
        </xsd:sequence>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name="EvidenceResponseType">
    <xsd:sequence>
      <xsd:element name="ErrorCode" type="cbc:CodeType" minOccurs="0" maxOccurs="unbounded"/>
      <xsd:element name="ErrorIndicator" type="cbc:IndicatorType" minOccurs="0" maxOccurs="1"/>
      <xsd:element ref="cbc:ID"/>
      <xsd:element name="IssueDate" type="cbc:DateTimeType"/>
      <xsd:element name="IssuePlace" type="cbc:TextType" minOccurs="0" maxOccurs="unbounded"/>
      <xsd:element name="LegalReference" type="cbc:TextType" minOccurs="0" maxOccurs="unbounded"/>
      <xsd:element ref="cbc:Name" minOccurs="0" maxOccurs="unbounded"/>
      <xsd:element name="Remarks" type="cbc:TextType" minOccurs="0" maxOccurs="unbounded"/>
      <xsd:element name="RespondsTo" type="cccev:CriterionType" minOccurs="0" maxOccurs="unbounded"/>
      <!--  <xsd:element name="ValidityPeriod" type="cbc:Period" minOccurs="0" maxOccurs="unbounded"/>  -->
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="LegalPersonType">
    <xsd:sequence>
      <xsd:element ref="cbc:ID"/>
      <xsd:element name="LegalName" type="cbc:NameType"/>
      <xsd:element name="VATRegistrationNumber" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="TaxReferenceNumber" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="BusinessCodes" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="LegalEntityIdentifier" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="EORIIdentifier" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="SEEDIdentifier" type="cbc:IDType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="StandardIndustrialClassification" type="cbc:CodeType" minOccurs="0"
        maxOccurs="1"/>
      <xsd:element name="AuthorizedRepresentativeIdentifier" type="cbc:IDType" minOccurs="0"
        maxOccurs="1"/>
      <xsd:element name="AlternativeLegalPersonIdentifier" type="cbc:IDType" minOccurs="0"
        maxOccurs="unbounded"/>
      <xsd:element name="LegalPersonLegalAddress" type="cagv:AddressType" minOccurs="0"
        maxOccurs="1"/>
    </xsd:sequence>
  </xsd:complexType>

  <xsd:complexType name="NaturalPersonType">
    <xsd:sequence>
      <xsd:element ref="cbc:ID"/>
      <xsd:element name="FamilyName" type="cbc:NameType"/>
      <xsd:element name="FirstName" type="cbc:NameType"/>
      <xsd:element name="BirthDate" type="cbc:DateOfBirthType"/>
      <xsd:element name="BirthFamilyName" type="cbc:NameType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="BirthPlace" type="cbc:NameType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="GenderCode" type="cbc:CodeType" minOccurs="0" maxOccurs="1"/>
      <xsd:element name="AlternativeNaturalPersonIdentifier" type="cbc:IDType" minOccurs="0"
        maxOccurs="unbounded"/>
      <xsd:element name="NaturalPersonLegalAddress" type="cagv:AddressType" minOccurs="0"
        maxOccurs="1"/>
    </xsd:sequence>
  </xsd:complexType>


  <xsd:complexType name="TOOPRequestType">
    <xsd:complexContent>
      <xsd:extension base="EDMType">
        <xsd:sequence>
          <xsd:element ref="cbc:CopyIndicator" minOccurs="0" maxOccurs="1"/>
          <xsd:element ref="SpecificationIdentifier"/>
          <xsd:element ref="DataConsumer"/>
          <xsd:element ref="DataConsumerDocumentIdentifier" minOccurs="0" maxOccurs="1"/>
          <xsd:element ref="DataConsumerGlobalSessionIdentifier" minOccurs="0" maxOccurs="1"/>
          <xsd:element ref="DataConsumerRequestPurpose" minOccurs="0" maxOccurs="unbounded"/>
          <xsd:element ref="DataRequestIdentifier" minOccurs="0" maxOccurs="1"/>
          <xsd:element ref="DataRequestSubject"/>
          <xsd:element ref="EvidenceRequest" minOccurs="0" maxOccurs="unbounded"/>
        </xsd:sequence>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>
  <xsd:complexType name="TOOPResponseType">
    <xsd:complexContent>
      <xsd:extension base="EDMType">
        <xsd:sequence>
          <xsd:element ref="DataProvider" minOccurs="0" maxOccurs="unbounded"/>
          <xsd:element ref="Error" minOccurs="0" maxOccurs="unbounded"/>
          <xsd:element ref="EvidenceResponse" minOccurs="0" maxOccurs="unbounded"/>
          <!--  
            For the XSD serialisation, a decision has to be made by TOOP on:
            
            1. Whether to refer to the ID of the Request, or
            2. to aggregate the Request within the Response, 0r
            3. have both possibilities in the EDM XSD and implement a Schematron rule to check that both are disjoint.
            
            The cardinality 0..1 for both elements is necessary to not make one of them or both compulsory. However, an additional Schematron rule would be necessary to impose one instance of either the reference or the aggregate object.
          -->
        </xsd:sequence>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>
</xsd:schema>
